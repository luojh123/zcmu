#include<iostream>  
#include<cstdio>  
#include<cstring>  
#include<string>  
#include<algorithm>  
  
using namespace std;  
  
int l,r,n,b;  
int f[35][35];  
int y[35];  
  
void init()  
{  
    f[0][0]=1;  
    for (int i=1;i<=31;++i)  
    {  
        f[i][0]=f[i-1][0];  
        for (int j=1;j<=i;++j) f[i][j]=f[i-1][j]+f[i-1][j-1];  
    }  
}  
  
int calc(int x,int k)  
{  
    int tmp=x,p=0;  
    int tot=0,ans=0;  
    memset(y,0,sizeof(y));  
    while(tmp)  
    {  
        y[p++]=tmp%b;  
        tmp/=b;  
    }  
    bool ok=1;  
    for(int i=p-1;i>=0;i--)  
    {  
        if(y[i]==1)  
        {  
            ans+=f[i][k-tot];  
            tot++;  
            if(tot>k) break;  
  
        }  
        else if(y[i]>1)  
        {  
            ans+=f[i][k-tot]+f[i][k-1-tot];  
            ok=0;  
            break;  
        }  
    }  
    return ans;  
}  
  
int main()  
{  
    init();  
    while(cin>>l>>r>>n>>b)  
        cout<<calc(r+1,n)-calc(l,n)<<endl;  
    return 0;  
}  